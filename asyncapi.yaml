asyncapi: 2.5.0
info:
  title: Shipment & Transportation Async API
  version: 1.0.0
  description: |-
    Event contracts implemented by the shipment transportation service.
    The service consumes `package-packed` events to create shipments and emits persisted
    outbox events to Kafka topics that match each event's type.
defaultContentType: application/json
servers:
  local:
    url: localhost:9092
    protocol: kafka
    description: Default Kafka bootstrap server used by the service during local development.
channels:
  package-packed:
    description: Upstream warehouse events consumed to trigger shipment creation.
    subscribe:
      summary: Consume package packed notifications.
      operationId: consumePackagePacked
      message:
        $ref: '#/components/messages/PackagePackedEvent'
  '{eventType}':
    description: Dynamic Kafka topic derived from the outbox event type.
    parameters:
      eventType:
        description: Event type persisted in the outbox (for example `shipment-dispatched`).
        schema:
          type: string
    publish:
      summary: Publish serialized outbox events.
      operationId: publishOutboxEvent
      message:
        $ref: '#/components/messages/OutboxEventMessage'
components:
  messages:
    PackagePackedEvent:
      name: packagePacked
      title: Package Packed
      payload:
        $ref: '#/components/schemas/PackagePackedPayload'
    OutboxEventMessage:
      name: outboxEvent
      title: Outbox Event
      payload:
        $ref: '#/components/schemas/OutboxEventPayload'
  schemas:
    PackagePackedPayload:
      type: object
      properties:
        packageId:
          type: string
          format: uuid
        orderId:
          type: string
        packedAt:
          type: string
          format: date-time
      required: [packageId, orderId, packedAt]
    OutboxEventPayload:
      type: object
      properties:
        aggregateType:
          type: string
        eventType:
          type: string
        payload:
          description: JSON payload produced by the aggregate.
          type: object
          additionalProperties: true
      required: [aggregateType, eventType, payload]
